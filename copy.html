<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">  
<title>Demo</title>
</head>

<body>

<p id="text">这是一段文字内容</p> 


<img id="image" src="https://github.com/lnzqw/lnzqw.github.io/blob/main/m2_gpu.jpg">

<button id="btn">点击复制文字和图片</button>

<script>

// 处理 CORS 错误
function handleCorsError(res) {
  if (!res.ok) {
    throw new Error(`CORS error: ${res.status}`); 
  }
  return res;
}

// 为 img 元素添加 getAsFile 方法
HTMLImageElement.prototype.getAsFile = async function() {

  
  const response = await fetch(this.src);
  const blob = await handleCorsError(response).blob();

  const filename = this.src.split('/').pop();

  const file = new File([blob], filename, {
    type: blob.type
  });

  return file; 
};

const text = document.getElementById('text');
const image = document.getElementById('image');
const btn = document.getElementById('btn');

btn.addEventListener('click', async () => {

  // 复制文本
  navigator.clipboard.writeText(text.innerText);

  // 获取图片文件 
  try {
    const imgFile = await image.getAsFile();

    const reader = new FileReader();
    reader.readAsArrayBuffer(imgFile);

    reader.onload = () => {
      // 处理 ArrayBuffer

      const dataView = new DataView(buffer);  
      const item = new ClipboardItem({
        'image/png': dataView
      });

      navigator.clipboard.write([item]);

    };

  } catch (err) {
    console.log(err); 
  }

});

</script>

</body>
</html>
